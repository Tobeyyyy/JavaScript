<!DOCTYPE html>
<html>
	<head>
		<title>UPC Converter</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>	
	<body>
	<div class="data_in_database">
		<h4>last start UPC:<p id="last_start"></p></h4>
		<h4>last end UPC:<p id="last_end"></p></h4>
	</div>
	<div class="content">
		<div>
		<input type="number" placeholder="enter start UPC" id="startupc" onchange="focusOnQty()" value="88524985761"/><br>
		</div>
		<div>
		<input type="number" placeholder="How many UPC you want" id="upcqty" onchange="focusOnSubmit()" value="7"/><br>
		</div>
		<input id="clickMe" type="button" onclick="uploadDB(timeStamp);" value="Submit">
		<div>
			<p>Result:</p>
			<div class="result_box" id="result_box">Result shows here...</div>
			<input id="exportTable" type="button" onclick="exportTableToExcel('upc_table');" value="Export to Excel">
		</div>
	</div>
	</body>
    <script src="js/script.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
     <script src="https://www.gstatic.com/firebasejs/4.1.1/firebase.js"></script>
	<script>
		<!-----------jquery-------------->
		//from IP Geolocation API
		document.getElementById("startupc").focus(); 
		function focusOnQty(){
		if($('#startupc').val().length==11){
			document.getElementById("upcqty").focus(); 
		}else{
			alert('You have '+$('#startupc').val().length+' digits UPC. \nPlease enter 11 digits UPC');
			document.getElementById("startupc").focus(); 
		}
		
		}
		function focusOnSubmit(){
			document.getElementById("clickMe").focus(); 
		}
		function getTime(){
			var today = new Date();
			var m = today.getMonth()+1;
			var d=today.getDate();
			var h=today.getHours();
			var t=today.getMinutes();
			var current= m+'/'+d+' '+h+':'+t;
			return current;
		}
		function getInputData(){
			var startupc=$('#startupc').val();
			var upcqty=$('#upcqty').val();
			console.log(startupc);
		}
		function showResult(upc_string){
			var html_content='<table id="upc_table"><tr><th>UPC Code</th><th>UPC Code - Inner Pack</th><th>UPC Code - Case</th></tr>';
		//	var loopnum=Math.ceil((upc_string.length-1)/3);
			for (var i=0;i<upc_string.length-1;i=i+3){
				html_content+='<tr><td>'+upc_string[i]+'</td><td>'+upc_string[i+1]+'</td><td>'+upc_string[i+2]+'</td>';
				html_content+='</tr>';
			}
			html_content+='</table>';
			$('#result_box').html(html_content);
		}
		var timeStamp=getTime();
		
		var recordArray={};
		function uploadDB(timeStamp){
		console.log(timeStamp);

			var startupc=$('#startupc').val();
			var upcqty=$('#upcqty').val();
			if(startupc!=='' && upcqty!=''){
				var upc_string=ConvertMultiple(startupc,upcqty);
				//$('#result_box').html(upc_string);
				
				upc_string=upc_string.split(',');
				showResult(upc_string);
				recordArray['timeStamp']=timeStamp;
				recordArray['startupc']=upc_string[0].substring(0,11);
				var last_upc=upc_string.length-2;
				recordArray['endupc']=upc_string[last_upc].substring(0,11);
				recordArray['upcqty']=upcqty;
				recordArray['upc_string('+upc_string.length+')']=upc_string;
				console.log(recordArray);
				pushData(recordArray);	
			}else{
				alert('Please enter data!');
				document.getElementById("startupc").focus(); 
			}
			
		}
	
  //Firebase
        function connectDB(){
            //initialize firebase
            var config={
                apiKey:"AIzaSyA7l48kyYuE6YJzofESse0Wlhcw4WdhUUo",
                authDomain:"tobeyyyy-github.firebaseio.com",
                databaseURL:"https://tobeyyyy-github.firebaseio.com",
                projectId:"tobeyyyy-github",
                storageBucket:"tobeyyyy-github.appspot.com",
                messagingSenderId:"600571938704"
            }
		firebase.initializeApp(config);
		var upcRecordReference=firebase.database().ref("upcRecord");
		return upcRecordReference;

	
        }
		
	function pushData(thisip){
		var upcRecordReference=connectDB();
		var newarrayRef=upcRecordReference.push();
	    	newarrayRef.set(thisip);
	}
	function fetchData(){
		var upcRecordReference=connectDB();
	}
fetchData();
	
	</script>

</html>
